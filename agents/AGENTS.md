# Agent Behavior Rules

## Conversation

1. ユーザーへの返答には日本語を使う。
2. ユーザーからの返答がないと先に進めないとき（タスク完了の確認やコマンドの実行の許可が必要なとき）は `say` コマンドで呼びかける。

## Coding

1. 差分を小さくする
   1. 与えられたタスクを段階的に進める計画を立て、各段階の差分が小さくなるようにする
   2. ファイルやディレクトリの改名・移動は先に行い、先に commit してからファイルを編集する
   3. 既存のコードを活用し、目的達成のための編集は最小限にする（似たような責務のコードを再作成したり、タスクの本質とは関係ない改修を勝手に行わない）
2. 未定義のものを使わない。新たにオブジェクトや関数を追加するときは先に定義してから、利用箇所で呼び出す。未定義のまま、先に利用箇所を実装するのは禁止。
3. コードを数行読めばわかるようなことはコメントはしない。設計理由など、コードを読んだだけじゃわからない場合のみコメントする。

## Markdown

.md ファイルを書くときは以下のルールに従う。 README.md や後述の Custom Instructions を書くときも、このルールを適用する。

1. 太字は使わず、必要最低限の装飾のみ行う。見出しも設けすぎない、深くしすぎない。必要さいて現にシンプルに書く。
2. 日本語で書く。

## README.md

以下の形式に従う。

```md
# {{ツール名}}

{{誰向けの、何を解決するツールか}}

## ユースケース

{{ユーザーができること、機能を箇条書きでまとめる}}

- xx できる
- xx 機能

## 手順書

### {{例: セットアップｊ}}

### {{例: 動作確認}}

## 技術スタック

- {{言語、ライブラリ、フレームワーク、クラウド実行環境、等}}

## アーキテクチャ

{{ 「DDD を採用している」や、 tree コマンドの結果に対して、各ディレクトリ・ファイルの説明など }}
```

## Custom Instructions

Custom Instructions (CLAUDE.md, GEMINI.md, AGENTS.md, .clinerules 等) を書く際は以下のルールに従う。

1. タスクに依存しない汎用的な指示やルールがユーザーから与えられた場合、 CLAUDE.md に追記するか確認する。
2. README.md と Custom Instructions で内容を重複させない。README.md に書くべきことは README.md に書き、 Custom Instructions には書かない。

## Task Flow

1. ユーザーからタスクが与えられたら、いくつかのステップに分解し、 `task/{YYY-mm-dd_task_title}.md` に書き起こす。書式は後述の「Task Markdown (task md) の書式」に従う。
2. 各ステップでの実装が完了したら、ビルドやリントなどの動作確認コマンドを実行し、エラーがなくなるまで繰り返す。3 回以上繰り返したり、解決策に自身がない場合は手を止めて、ユーザーに相談する。
3. **（厳守！！）各ステップが完了したら必ず手を止めて、ユーザーに `say` コマンドで終了のメッセージを通知する。ユーザーから許可があるまで絶対に次のステップに進まない。ユーザーの許可なしに次のステップに勝手に進むことは厳禁。絶対にやらないで。**
4. 各ステップを終える際は、本質的な作業内容を要約したコミットメッセージを考え、 git commit を実行。

### Task Markdown (task md) の書式

```md
# タスクのタイトル

1. [ ] ステップ 1
   1. [x] ステップ 1-1
   2. [ ] ステップ 1-2
2. [ ] ステップ 2
```

1. 見出し（#, ##, ###）はタイトルのみ使い、他の場所で使うのは禁止。
2. 各ステップは「番号付きリスト」で表現する。番号のない箇条書きを使うこと禁止。
3. 各ステップの文頭には必ず `[ ]` （チェックボックス）を付け進捗を管理する。完了済みは `[x]`、未着手は `[ ]` で表現する。
4. **太字** や _斜体_ など、余計な装飾を使うのは禁止。

## Project Catch Up

以下のいずれかの条件のとき、後述の「キャッチアップ手順」を行う。

### 条件

1.  READMD.md が上述の「READ.md」ルールに従ってないとき
2.  自身が読み込める Custom Instructions のファイルが存在しないとき

### キャッチアップ手順

1.  `tree` コマンドを使ったり、多くのファイルを読み込んで、プロジェクトの全体像を把握し、 README.md を上述の「README.md」ルールに従うように作成・編集する。すでに書いてある内容は消さずに、上述のルールに上手く組み込んで残す。
2.  READMD.md に書くべきでないプロジェクト固有のルール、開発フロー、動作確認方法などがあれば、 Custom Insructions を作成・追記する。すでに書いてある内容は消さずに、上述のルールに上手く組み込んで残す
