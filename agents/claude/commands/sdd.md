---
description: Spec-Driven Development - 仕様書を先に書いてから実装する
argument-hint: [機能名/ファイルパス（オプション）]
---

Spec-Driven Development のアプローチで開発を進めます。

## ステップ

以下の手順で段階的に進めてください：

**（厳守！！）各ステップが完了したら必ず手を止めて、ユーザーに確認する。ユーザーから許可があるまで絶対に次のステップに進まない。ユーザーの許可なしに次のステップに勝手に進むことは厳禁。絶対にやらないで。**

1. requirements.md を作成
   - 必要に応じて、要件に関する不明点をユーザーに質問する
   - 機能要件
   - (任意) 非機能要件
   - **作成後、ユーザー確認を求める。ユーザーから許可があるまでは design.md の作成には進まない。**

2. design.md を作成
   - 必要に応じて、設計に関する不明点をユーザーに質問する
   - 処理フロー
   - 編集・新規作成するファイルやオブジェクトのパス
   - 新しくデータベースのモデリングをする必要がある場合
     - エンティティの洗い出し
     - エンティティをリソースとイベントに分類する
     - エンティティのアトリビュートの洗い出し
     - イベントの時系列を明確にする
     - エンティティ間のリレーションシップを明らかにする
     - 主キー、ユニーク制約、インデックスの洗い出し
   - 具体的なコードは書かない。なるべく抽象的に簡潔に記載する
   - **作成後、ユーザー確認を求める。ユーザーから許可があるまでは tasks.md の作成には進まない。**

3. tasks.md を作成
   - 必要に応じて、実装方針に関する不明点をユーザーに質問する
   - 実装ステップを番号付きリストで記載
   - 各ステップでは、具体的に**どのファイルのどのオブジェクト（関数、クラス、変数等）を編集するか**を明記。ただし、パスを書かずにファイル名のみでよい。
   - 動作確認をしやすくするため、ユーザーに近い側から実装する順番にタスクを組む。
     - DDD アーキテクチャを採用している場合は、最初に Presentation 層から実装する。その際、新たに Domain model 等が必要であれば同じタスクで追加するが、Application や　Infrastructure 層は改修せず、ダミーデータやモックを用いる。
     - Presentation 層が終わってから Application や Infrastructure 層（Repository の実装を含む）を実装する。
     - Application や Infrastructure を実装する際、呼び出し側のダミーを差し替える作業も同じタスクに含める。
     - 例：SwiftUI の iOS アプリであれば View から、 Go の API であれば Controller (Handler) から実装する。
   - 技術的な詳細は task.md ではなく design.md に記載。 task.md は抽象的に書く。
     - NG例：FooView に @State isPresented を追加する。 body に .alert(isPresented) { AlertView } を追加する。
     - OK例：FooView で内容保存時にアラートを追加する
   - 各ステップの依存関係を明記
   - チェックボックス `[ ]` で進捗管理
   - 書式は下記の「tasks.md の書式」に従う
   - 粒度は細かくしすぎない。箇条書きのネストは 2 段階まで（1.1 は OK。1.1.1 は NG）とし、1 ステップのタスクの大きさは「1 commit = 差分を確認しやすい大きさ = 動作確認しやすい大きさ」にする。design.md や requirements.md を見ればわかるような詳細をサブタスクとして切らない。
   - 動作確認はわざわざステップにせず、各ステップ実装後に毎回行う。ただし、ステップとして明記は不要。

tasks.md の書式:

- 見出しはタイトルのみ使い、他の場所で使うのは禁止。
- 各ステップは番号付きリストで表現し、番号のない箇条書きは禁止。
- 各ステップの文頭には必ず `[ ]` を付けて進捗を管理する。完了済みは `[x]`、未着手は `[ ]` で表現する。
- 太字や斜体など、余計な装飾は禁止。
- 最初に次を記載：**（厳守！！）各ステップが完了したら必ず手を止めて、ユーザーに許可を得る。ユーザーから許可があるまで絶対に次のステップに進まない。ユーザーの許可なしに次のステップに勝手に進むことは厳禁。絶対にやらないで。ユーザーからのステップ完了の許可を得たら tasks.md のチェックボックスを `[x]` に更新し、次のステップに進む。**

```md
# タスクのタイトル

**（厳守！！）各ステップが完了したら必ず手を止めて、ユーザーに許可を得る。ユーザーから許可があるまで絶対に次のステップに進まない。ユーザーの許可なしに次のステップに勝手に進むことは厳禁。絶対にやらないで。ユーザーからのステップ完了の許可を得たら tasks.md のチェックボックスを `[x]` に更新し、次のステップに進む。**

1. [ ] src/foo.ts の bar 関数を編集
   1. [x] 引数の型を追加
   2. [ ] 戻り値の型を追加
2. [ ] src/baz.ts に qux 関数を追加
```

4. task.md のセルフレビュー
   - ユーザーに task.md を確認する前に step3 に記載の task.md のルールが守れてるかレビュー・修正する。
     - 特に「Presentation 層から実装できているか」を守れていないことが多いので、そこが厳守できてるかチェック。

5. 段階的な実装
   - tasks.md の各ステップごとに実装を進める
   - 各ステップ完了後に、ビルドやリントなどの動作確認コマンドを実行し、エラーがなくなるまで繰り返す
   - 3 回以上繰り返したり、解決策に自信がない場合は手を止めて、ユーザーに相談する
   - **（厳守！！）各ステップが完了したら必ず手を止めて、ユーザーに許可を得る。ユーザーから許可があるまで絶対に次のステップに進まない。ユーザーの許可なしに次のステップに勝手に進むことは厳禁。絶対にやらないで。**
   - ユーザーからのステップ完了の許可を得たら tasks.md のチェックボックスを `[x]` に更新し、次のステップに進む。

## 対象

$ARGUMENTS

ドキュメントは specs/{YYYY-mm-dd}\_$ARGUMENTS/ に作成
